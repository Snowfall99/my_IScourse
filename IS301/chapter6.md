# 链路层和局域网
## 链路层概述
- 链路层提供的服务：
    - 成帧：在每个网络层数据报经链路传送之前，几乎所有的链路层协议都要将其用链路层帧封装起来
    - 链路接入：媒体访问控制(MAC)协议规定了帧在链路上传输的规则
    - 可靠交付：当链路层协议提供可靠交付服务时，它保证无差错地经链路层移动每个网络层数据报
    - 差错检测和纠正
## 差错检测和纠正技术
### 奇偶校验
- 使用单个奇偶校验位
- 二维奇偶校验
- 接收方检测和纠正错误的能力称为前向纠错
### 检验和方法
- 因特网检验和：数据的字节作为16比特的整数对待并求和，这个和的反码形成了携带在报文首部的因特网检验和
- 检验和方法需要相对较小的分组开销
### 循环冗余检测(CRC)
- CRC编码也称为多项式编码
- CRC编码操作如下
    - 考虑d比特的数据D
    - 发送方和接收方首先必须协商一个r+1比特模式，称为生成多项式G
    - G的最高有效位为1
    - 对于一个给定的数据段D，发送方要选择r个附加比特R，并用它们附加到D上，使得得到的d+r比特模式用模2算术恰好能被G整除
    - CRC检测过程
        - 接收方用G去除接收到的d+r比特
        - 如果余数为非零，接收方知道出现了差错
- 每个CRC标准都能检测到小于r+1比特的突发差错
- 长度大于r+1比特的突发差错以概率$1-0.5^r$被检测到
## 多路访问链路和协议
- 点对点链路：由链路一端的单个发送方和链路另一端的单个接收方组成
- 广播链路：能够让多个发送和接收节点都连接到相同的、单一的、共享的广播信道上
### 信道划分协议
- 时分多路复用TDM
    - 将时间划分为时间帧
    - 进一步划分每个时间帧为N个时隙
    - 某个节点有分组要发送时，它在循环的TDM帧中指派给它的时隙内传输分组比特
- 频分多路复用FDM
- 码分多址CDMA
    - CDMA对每个节点分配一种不同的编码
    - 节点用它唯一的编码来对它发送的数据进行编码
### 随机接入协议
- 一个传输节点总是以信道的全部速率进行发送
- 当有碰撞时，涉及碰撞的每个节点反复地重发它的帧，直到该帧无碰撞地通过为止
- 节点发生碰撞时，不必立刻重发该帧；相反，它在重发该帧之前等待一个随机时延
#### 1.时隙ALOHA协议
- 当一个节点有一个新帧要发送的时候，它等到下一个时隙开始并在该时隙传输整个帧
- 如果没有碰撞，该节点成功地传输它的帧，从而不需要考虑重传该帧
- 如果有碰撞，该节点在时隙结束之前检测到这次碰撞。该节点以概率p在后续的每个时隙中重传它的帧，直到该帧被无碰撞地传输出去
#### 2.ALOHA
- 当一个帧首次到达，节点立刻将该帧完整地传输进广播信道
- 如果一个传输地帧与一个或多个传输经历了碰撞，这个节点将立即以概率p重传该帧
- 否则该节点将等待一个帧传输时间，在此等待后，它则以概率p传输该帧，或者以概率1-p在另一个帧时间等待
#### 3.载波侦听多路访问(CSMA)
#### 4.具有碰撞检测的载波侦听多路访问(CSMA/CD)
### 轮流协议
1. 轮询协议
    - 一个主节点
    - 主节点以循环的方式轮询每个节点
    - 消除了碰撞和空时隙
    - 引入了轮询时延
    - 如果主节点有故障，整个信道都变得不可操作
1. 令牌传递协议
    - 一个被称为令牌的小的特殊帧在节点之间以某种固定的次序进行交换
## 交换局域网
### 链路层寻址和ARP
- MAC地址
    - 链路层地址又被称为LAN地址、物理地址或MAC地址
    - 没有两块适配器具有相同的地址
- 地址解析协议(ARP)
    - 进行网络层地址(IP地址)和链路层地址(MAC地址)之间的转换
    - ARP只为在同一个子网上的主机和路由器接口解析IP地址
    - ARP表：包含IP地址到MAC地址的映射关系
    - 查询ARP报文在广播帧中发送，而响应ARP报文在一个标准帧中发送
### 以太网
- 以太网帧
    - 数据字段（46-1500字节）：承载了IP数据报
    - 目的地址(6字节)：包含目的适配器的MAC地址
    - 源地址（6字节）：包含了传输该帧到局域网上的适配器的MAC地址
    - 类型字段（2字节）：类型字段允许以太网复用多种网络层协议
    - CRC（4字节）：使得接收适配器检测帧中是否引入了差错
    - 前同步码（8字节）：“唤醒”接收适配器
### 链路层交换机
- 交换机的主要任务是接收入链路层帧并将它们转发到出链路
- 交换机转发和过滤
    - 过滤：是决定一个帧应该转发到某个端口还是应当将其丢弃的交换机功能
    - 转发：是决定一个帧应该被导向哪个接口，并把该帧移动到那些接口的交换机功能
    - 交换机的过滤和转发借助于交换机表，表项包括
        1. 一个MAC地址
        1. 通向该MAC地址的交换机接口
        1. 表项放置在表中的时间
- 自学习
    - 交换机表初始为空
    - 对于在每个接口接收到的每个入帧，该交换机在其表中存储
        1. 该帧源地址字段中的MAC地址
        1. 该帧到达的接口
        1. 当前的时间
    - 如果在一段时间后，交换机没有接收到以该地址作为源的帧，就在该表中删除这个地址
- 优势：
    - 消除碰撞
    - 异质的链路：交换机将链路彼此隔离，因此局域网中的不同链路能够以不同速率运行并且能够在不同媒体上运行
    - 管理：除了强化的安全性，交换机也易于进行网络管理
### 虚拟局域网（VLAN）
- 支持VLAN的交换机允许经一个单一的物理局域网基础设施定义多个虚拟局域网
- 一个VLAN内的主机彼此通信，仿佛它们与交换机连接
- 在一个基于端口的VLAN中，交换机的端口由网络管理员划分为组
- 每个组构成一个VLAN，在每个VLAN中的端口形成一个广播域（即来自一个端口的广播流量仅能到达该组中其他端口）
