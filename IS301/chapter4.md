# 网络层：数据平面
### 网络层概述
路由器的的数据平面的主要作用是从其输入链路向输出链路转发数据报；控制平面的主要作用是协调这些本地的路由器转发动作，使得数据报沿着源和目的地主机之间的路由器路径进行端到端传送。
###### 两种重要的网络层功能
1. 转发：当一个分组到达某路由器的一条输入链路时，该路由器必须将该分组移动到适当的输出链路
1. 路由选择：当分组从发送方流向接收方时，网络层必须决定这些分组所采用的路由或路径
###### 网络服务模型
1. 确保交付：该服务确保分组最终到达目的地
1. 具有时延上届的确保交付：该服务不仅确保分组的交付，而且在特定的主机到主机时延上届内交付
1. 有序分组交付：该服务确保分组以它们发送的顺序到达目的地
1. 确保最小带宽
1. 安全性

### 路由器工作原理
###### 路由器组件
1. **输入端口**：输入端口在路由器中执行终结入物理链路的物理层功能；它还要与位于入链路远端的数据链路层交互来执行数据链路层的功能；在输入端口还要执行查找功能，正是在这里，通过查询转发表决定路由器的输出端口，到达的分组通过路由器的交换结构转发到输出端口
1. **交换结构**：交换结构将路由器的输入端口连接到它的输出端口
1. **输出端口**：输出端口存储从交换结构接收的分组，并通过执行必要的链路层和物理层功能在输出链路上传输这些分组
1. **路由选择处理器**
###### 输入端口处理和基于目的地转发
在输入端口中，路由器通过转发表来查找输出端口，使得到达的分组能经过交换结构转发到该输出端口。转发表是由路由选择处理器计算和更新的，或者转发表接收来自远程SDN控制器的内容。路由器使用分组目的地址的前缀与该表中的表项进行匹配，如果存在一个匹配项，则路由器向与该匹配项相关联的链路转发分组；当有多个匹配项时，路由器使用最长前缀匹配规则，即在该表项中寻找最长的匹配项，并向最长前缀匹配相关联的链路接口转发分组
###### 交换
- 经内存交换
- 经总线交换：输入端口经一根共享总线将分组直接传送到输出端口，不需要路由选择处理器的干预
- 经互联网络交换：纵横式网络能够并行转发多个分组。纵横式交换机是非阻塞的，即只要没有其他分组当前被转发到该输出端口，转发到输出端口的分组将不会被到达输出端口的分组阻塞
### 排队
在输入端口和输出端口都可能形成分组队列，随着队列的增长，路由器的缓存空间最终将被耗尽，并且当无内存可用于存储到达分组时将出现丢包
###### 输入排队
- 线路前端阻塞：在一个输入队列中排队的分组必须等待通过交换结构发送，因为它被位于线路前部的另一个分组所阻塞
###### 输出排队
当没有足够的内存空间来缓存一个入分组时，就必须做出决定：要么丢弃到达的分组(采用一种称为弃尾的策略)，要么删除一个或多个已排队的分组为新来的分组腾出空间。在某些情况下，在缓存填满之前便丢弃一个分组（或在其首部加上标记）的做法是有利的，这可以向发送方提供一个拥塞信号，这种类似的策略被称为主动队列管理算法。
###### 分组调度
- **先进先出FIFO(FCFS)：** FIFO调度规则按照分组到达输出链路队列的先后次序来选择分组在链路上传输。
- **优先权队列：** 在优先权排队规则下，到达输出链路的分组被分类放入输出队列中的优先权类。当选择一个分组传输时，优先权排队规则将从队列为非空的最高优先权类中传输一个分组。在同一优先权类的分组之间的选择通常以FIFO方式完成。在非抢占式优先权排队规则下，一旦分组开始传输，就不能被打断。
- **循环和加权公平排队：** 在循环排队规则下，分组向使用优先权排队那样被分类。然而，在类之间不存在严格的服务优先权，循环调度器在这些类之间轮流提供服务。一个所谓的保持工作排队规则在有分组排队等待传输时，不允许链路保持空闲。当寻找给定类的分组但是没有找到时，保持工作的循环规则将立即检查循环序列中的下一个类。一种通用形式的循环排队已经广泛地实现在路由器中，它就是所谓地加权公平排队规则。

### 动态主机配置协议(DHCP)
### 网络地址转换(NAT)
### 通用转发和SDN

